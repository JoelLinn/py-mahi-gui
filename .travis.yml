services:
  - docker

matrix:
  include:
    - arch: amd64
      env: DOCKER_IMAGE=quay.io/pypa/manylinux2014_i686
           PRE_CMD=linux32
           PLAT=manylinux2014_i686
    - arch: amd64
      env: DOCKER_IMAGE=quay.io/pypa/manylinux2014_x86_64
           PLAT=manylinux2014_x86_64
    - arch: arm64
      env: DOCKER_IMAGE=quay.io/pypa/manylinux2014_aarch64
           PLAT=manylinux2014_aarch64
    - arch: ppc64le
      env: DOCKER_IMAGE=quay.io/pypa/manylinux2014_ppc64le
           PLAT=manylinux2014_ppc64le
    # - arch: s390x
    #   env: DOCKER_IMAGE=quay.io/pypa/manylinux2014_s390x
    #        PLAT=manylinux2014_s390x

install:
  - docker pull $DOCKER_IMAGE

script:
  - docker run --rm -e PLAT=$PLAT -v `pwd`:/io $DOCKER_IMAGE $PRE_CMD /io/build-wheels.sh
  - ls -lah wheelhouse/
  # ARTIFACT_URL_BASE=https://some.cloud.com/public.php/webdav/
  # ARTIFACT_USER=share_token
  - |
    if [[ -v ARTIFACT_URL_BASE ]]; then
      cd wheelhouse
      for whl in *.whl; do
        curl -T ${whl} -u "${ARTIFACT_USER}:${ARTIFACT_PASS}" -H 'X-Requested-With: XMLHttpRequest' "${ARTIFACT_URL_BASE}${whl}"
      done
    fi

